<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FB Link Parser</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
      padding: 24px;
      color: #1c1e21;
    }

    h1 {
      font-size: 1.4em;
      color: #1877f2;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .top-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .card h2 {
      font-size: 0.9em;
      color: #65676b;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    textarea {
      width: 100%;
      height: 200px;
      padding: 12px;
      border: 2px solid #e4e6ea;
      border-radius: 8px;
      font-size: 0.85em;
      font-family: monospace;
      resize: vertical;
      transition: border-color 0.2s;
      color: #1c1e21;
    }

    textarea:focus {
      outline: none;
      border-color: #1877f2;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 9px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }

    button:hover { opacity: 0.88; }
    button:active { transform: scale(0.97); }

    .btn-parse { background: #1877f2; color: white; }
    .btn-clear { background: #e4e6ea; color: #1c1e21; }
    .btn-copy-tsv { background: #42b883; color: white; }
    .btn-copy-excel { background: #217346; color: white; }

    .stats {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stat {
      background: #f0f2f5;
      border-radius: 8px;
      padding: 10px 16px;
      text-align: center;
      min-width: 80px;
    }

    .stat-num {
      font-size: 1.6em;
      font-weight: bold;
      color: #1877f2;
    }

    .stat-label {
      font-size: 0.72em;
      color: #65676b;
      margin-top: 2px;
    }

    .table-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .table-header h2 { font-size: 1em; color: #1c1e21; }

    .table-wrap {
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid #e4e6ea;
    }

    table { width: 100%; border-collapse: collapse; font-size: 0.82em; }

    thead th {
      background: #1877f2;
      color: white;
      padding: 10px 12px;
      text-align: left;
      position: sticky;
      top: 0;
      white-space: nowrap;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    tbody tr:nth-child(even) { background: #f7f8fa; }
    tbody tr:hover { background: #e7f0fd; }

    tbody td {
      padding: 8px 12px;
      border-bottom: 1px solid #f0f2f5;
      white-space: nowrap;
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag-userid {
      background: #fff3cd;
      color: #856404;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.85em;
      font-family: monospace;
    }

    .tag-username {
      background: #d1ecf1;
      color: #0c5460;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.85em;
      font-family: monospace;
    }

    a { color: #1877f2; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #65676b;
      font-size: 0.9em;
    }

    .empty-state .icon { font-size: 2.5em; margin-bottom: 10px; }

    .info-banner {
      background: #e7f3ff;
      border-left: 4px solid #1877f2;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 0.82em;
      color: #444;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .info-banner strong { color: #1877f2; }
    .info-banner code {
      background: #d0e8ff;
      padding: 1px 5px;
      border-radius: 4px;
      font-size: 0.95em;
    }

    @media (max-width: 768px) {
      .top-area { grid-template-columns: 1fr; }
      body { padding: 12px; }
    }
  </style>
</head>
<body>

  <h1>&#x1F535; Facebook Link Parser</h1>

  <div class="info-banner">
    <strong>&#x2699; Cara kerja deduplication:</strong><br>
    Duplikat ditentukan berdasarkan <strong>USERID</strong> atau <strong>USERNAME</strong> yang sama &mdash; bukan full URL.<br>
    Link yang mengandung kata <code>friends</code>, <code>mutual</code>, <code>friends_mutual</code>, <code>friends-mutual</code> otomatis diabaikan.
  </div>

  <div class="top-area">
    <div class="card">
      <h2>&#x1F4CB; Paste Link Facebook</h2>
      <textarea id="inputArea" placeholder="Paste link di sini...

Mendukung format:
- https://www.facebook.com/username
- https://www.facebook.com/profile.php?id=123
- Nama|^|https://www.facebook.com/username

Link /friends_mutual otomatis diabaikan.
Duplikat username/userid dihitung 1."></textarea>
      <div class="btn-row">
        <button class="btn-parse" onclick="parseLinks()">&#x26A1; Parse</button>
        <button class="btn-clear" onclick="clearAll()">&#x1F5D1; Clear</button>
      </div>
    </div>

    <div class="card">
      <h2>&#x1F4CA; Statistik</h2>
      <div class="stats">
        <div class="stat">
          <div class="stat-num" id="statTotal">0</div>
          <div class="stat-label">Total Input</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statResult">0</div>
          <div class="stat-label">Hasil Unik</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statSkipped">0</div>
          <div class="stat-label">Diabaikan</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statDupe">0</div>
          <div class="stat-label">Duplikat</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statUserid">0</div>
          <div class="stat-label">Profile ID</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statUsername">0</div>
          <div class="stat-label">Username</div>
        </div>
      </div>
    </div>
  </div>

  <div class="table-card">
    <div class="table-header">
      <h2>&#x1F4CB; Hasil Parse</h2>
      <div class="btn-row">
        <button class="btn-copy-tsv" onclick="copyTSV()">&#x1F4C4; Copy TSV</button>
        <button class="btn-copy-excel" onclick="copyExcel()">&#x1F4CA; Copy ke Excel</button>
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>USERID</th>
            <th>USERNAME</th>
            <th>NAME</th>
            <th>EMAIL</th>
            <th>MSISDN</th>
            <th>URL</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="icon">&#x1F517;</div>
                Paste link Facebook di atas, lalu klik Parse
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let parsedData = [];

    // Semua kata kunci yang harus diabaikan di URL
    const IGNORE_PATTERN = /friends[_\-]?mutual|[_/?&]friends([_\-/]|$)|[_/?&=]mutual|\/friends$/i;

    function parseLinks() {
      const raw   = document.getElementById('inputArea').value;
      const lines = raw.split('\n').map(l => l.trim()).filter(l => l.length > 0);

      const seenKeys = new Set();
      const results  = [];
      let totalInput = 0;
      let skipped    = 0;
      let dupeCount  = 0;

      lines.forEach(line => {
        let name = '';
        let url  = '';

        // Deteksi format Name|^|URL atau plain URL
        if (line.includes('|^|')) {
          const idx = line.indexOf('|^|');
          name = line.substring(0, idx).trim();
          url  = line.substring(idx + 3).trim();
        } else if (line.startsWith('http')) {
          url = line.trim();
        } else {
          return; // bukan URL, skip
        }

        if (!url.includes('facebook.com')) return;

        totalInput++;

        // Abaikan semua URL yang mengandung friends / mutual dalam bentuk apapun
        if (IGNORE_PATTERN.test(url)) {
          skipped++;
          return;
        }

        // Parse USERID dan USERNAME
        let userid   = '';
        let username = '';

        if (url.includes('profile.php?id=')) {
          const match = url.match(/profile\.php\?id=(\d+)/);
          if (match) userid = match[1];
        } else {
          try {
            const u    = new URL(url);
            // Ambil segment pertama dari path saja
            const seg  = u.pathname.replace(/^\//, '').split('/')[0];
            if (seg) username = seg;
          } catch(e) {
            const match = url.match(/facebook\.com\/([^/?#]+)/);
            if (match) username = match[1];
          }
        }

        // Deduplication key: berdasarkan userid ATAU username (bukan full URL)
        const key = userid
          ? 'id:' + userid.toLowerCase()
          : 'u:'  + username.toLowerCase();

        if (seenKeys.has(key)) {
          dupeCount++;
          return;
        }
        seenKeys.add(key);

        results.push({ userid, username, name, email: '', msisdn: '', url });
      });

      parsedData = results;

      document.getElementById('statTotal').textContent    = totalInput;
      document.getElementById('statResult').textContent   = results.length;
      document.getElementById('statSkipped').textContent  = skipped;
      document.getElementById('statDupe').textContent     = dupeCount;
      document.getElementById('statUserid').textContent   = results.filter(r => r.userid).length;
      document.getElementById('statUsername').textContent = results.filter(r => r.username).length;

      renderTable(results);
    }

    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">
          <div class="empty-state"><div class="icon">&#x26A0;</div>Tidak ada data valid ditemukan</div>
        </td></tr>`;
        return;
      }

      tbody.innerHTML = data.map((row, i) => `
        <tr>
          <td>${i + 1}</td>
          <td>${row.userid   ? `<span class="tag-userid">${row.userid}</span>`     : ''}</td>
          <td>${row.username ? `<span class="tag-username">${row.username}</span>` : ''}</td>
          <td>${row.name     || ''}</td>
          <td>${row.email    || ''}</td>
          <td>${row.msisdn   || ''}</td>
          <td><a href="${row.url}" target="_blank" title="${row.url}">${row.url}</a></td>
        </tr>
      `).join('');
    }

    function copyTSV() {
      if (!parsedData.length) { alert('Belum ada data!'); return; }
      const header = 'USERID\tUSERNAME\tNAME\tEMAIL\tMSISDN\tURL';
      const rows   = parsedData.map(r => `${r.userid}\t${r.username}\t${r.name}\t${r.email}\t${r.msisdn}\t${r.url}`);
      toClipboard([header, ...rows].join('\n'));
      showToast('TSV berhasil dicopy!');
    }

    function copyExcel() {
      if (!parsedData.length) { alert('Belum ada data!'); return; }
      const header = 'USERID\tUSERNAME\tNAME\tEMAIL\tMSISDN\tURL';
      const rows   = parsedData.map(r => `${r.userid}\t${r.username}\t${r.name}\t${r.email}\t${r.msisdn}\t${r.url}`);
      toClipboard([header, ...rows].join('\n'));
      showToast('Data siap di-paste ke Excel!');
    }

    function toClipboard(text) {
      navigator.clipboard.writeText(text).catch(() => {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
      });
    }

    function clearAll() {
      document.getElementById('inputArea').value = '';
      parsedData = [];
      document.getElementById('tableBody').innerHTML = `<tr><td colspan="7">
        <div class="empty-state"><div class="icon">&#x1F517;</div>Paste link Facebook di atas, lalu klik Parse</div>
      </td></tr>`;
      ['statTotal','statResult','statSkipped','statDupe','statUserid','statUsername'].forEach(id => {
        document.getElementById(id).textContent = '0';
      });
    }

    function showToast(msg) {
      const el = document.createElement('div');
      el.textContent = '\u2705 ' + msg;
      el.style.cssText = `
        position: fixed; bottom: 24px; right: 24px; z-index: 9999;
        background: #1c1e21; color: white; padding: 12px 20px;
        border-radius: 10px; font-size: 0.9em; font-weight: 600;
        box-shadow: 0 4px 16px rgba(0,0,0,0.25);
      `;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2500);
    }

    // Auto-parse saat paste
    document.getElementById('inputArea').addEventListener('paste', () => {
      setTimeout(parseLinks, 100);
    });
  </script>

</body>
</html>
